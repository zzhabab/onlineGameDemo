{"version":3,"file":"HelloWorld-DRvE8JOn.js","sources":["../../src/components/HelloWorld.vue"],"sourcesContent":["<script setup lang=\"ts\">\r\n  import { ref, reactive, onMounted, nextTick } from 'vue'\r\n  import { useCounterStore } from '@/stores/counter'\r\n  import { ElLoading } from 'element-plus'\r\n  \r\n  const counter = useCounterStore()\r\n  const serverAddress = 'ws://localhost:8080'\r\n  let ws: WebSocket\r\n  const firstEnterTime = new Date()\r\n  let reconnectCount = 0\r\n  let connectLoading: any\r\n  const settingShow = ref(false)\r\n  const storeShow = ref(false)\r\n  const keyboardCommands = [\r\n    {\r\n      behavior: 'forward',\r\n      optionOne: 'w',\r\n      optionTwo: 'arrowup'\r\n    },\r\n    {\r\n      behavior: 'backward',\r\n      optionOne: 's',\r\n      optionTwo: 'arrowdown'\r\n    },\r\n    {\r\n      behavior: 'turnLeft',\r\n      optionOne: 'a',\r\n      optionTwo: 'arrowleft'\r\n    },\r\n    {\r\n      behavior: 'turnRight',\r\n      optionOne: 'd',\r\n      optionTwo: 'arrowright'\r\n    }\r\n  ]\r\n  let characterElement: HTMLDivElement\r\n  const characterElementList: Array<{\r\n    uuid: string,\r\n    element: HTMLDivElement\r\n  }> = []\r\n  const behaviorArray = keyboardCommands.map(({ behavior }) => behavior);\r\n  const optionOneArray = keyboardCommands.map(({ optionOne }) => optionOne);\r\n  const optionTwoArray = keyboardCommands.map(({ optionTwo }) => optionTwo);\r\n  const chatMessage = ref('')\r\n  // ���������historyContentList.push(1)Ҳ������ֱ�����Ҳ������Ҫʲô����������\r\n  const historyContentList = reactive<string []>([])\r\n  \r\n  onMounted(() => {\r\n    connectLoading = ElLoading.service({\r\n      lock: true,\r\n      text: 'Loading',\r\n      background: 'rgba(0, 0, 0, 0.7)',\r\n    })\r\n    establishConnection()\r\n    initClassNameMoreDiv()\r\n  })\r\n  const loadScene = () : Promise<boolean> => {\r\n    return new Promise((resolve, reject) => {\r\n      try {\r\n        const containerElement = document.querySelector('.container')\r\n        const sceneElement = document.createElement('div')\r\n        sceneElement.setAttribute('class', 'scene')\r\n        sceneElement.style.width = '100vw'\r\n        sceneElement.style.height = '100vh'\r\n        sceneElement.style.backgroundColor = 'a'\r\n        containerElement!.appendChild(sceneElement)\r\n        resolve(true)\r\n      } catch (e) {\r\n        console.error('��������ʧ��', e)\r\n        reject(false)\r\n      }\r\n    })\r\n  }\r\n  const loadCharacter = (uuid: string) : Promise<boolean> => {\r\n    return new Promise((resolve, reject) => {\r\n      try {\r\n        const sceneElement = document.querySelector('.scene')\r\n        characterElement = document.createElement('div')\r\n        characterElement.setAttribute('id', uuid)\r\n        characterElement.style.width = '5vw'\r\n        characterElement.style.height = '5vh'\r\n        characterElement.style.backgroundColor = 'antiquewhite'\r\n        characterElement.style.position = 'fixed'\r\n        characterElement.innerText = uuid\r\n        sceneElement!.appendChild(characterElement)\r\n        characterElementList.push({\r\n          uuid: uuid,\r\n          element: characterElement\r\n        })\r\n        resolve(true)\r\n      } catch (e) {\r\n        console.error('��ɫ����ʧ��', e)\r\n        reject(false)\r\n      }\r\n    })\r\n  }\r\n  const reqKeyboardCommands = () => {\r\n    fetch('http://localhost:9123/test', {\r\n      method: 'post',\r\n      body: JSON.stringify({\r\n        name: 'zzh'\r\n      }),\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n      }\r\n    })\r\n    .then(response => response.text())\r\n    .then(data => {\r\n      console.log(`response:${JSON.stringify(data)}`)\r\n    })\r\n    .catch(err => {\r\n      console.log(`err:${JSON.stringify(err)}`)\r\n    })\r\n  }\r\n  const setControl = () => {\r\n    // ���ֲ�����ʽ\r\n    if (counter.deviceType === 'PC') {\r\n      reqKeyboardCommands()\r\n      window.addEventListener('keydown', (e) => {\r\n        const keydownEventTarget: HTMLInputElement = e.target as HTMLInputElement\r\n        if (keydownEventTarget.getAttribute('id') === 'userInputBox') {\r\n          return\r\n        }\r\n        const obj = {\r\n          type: 'behavior',\r\n          data: e.key.toLowerCase(),\r\n          uuid: counter.uuid\r\n        }\r\n        ws.send(JSON.stringify(obj))\r\n      })\r\n    } else {\r\n      \r\n    }\r\n  }\r\n  const initClassNameMoreDiv = () => {\r\n    const moreBoxElement: HTMLDivElement = document.querySelector('.moreBox') as HTMLDivElement\r\n    // ������hoverչ�����ƶ�����click\r\n    if (counter.deviceType === 'PC') {\r\n      moreBoxElement!.addEventListener('mouseenter', e => {\r\n        moreBoxElement.style.height = 'calc(9vw + 20px)'\r\n      })\r\n      moreBoxElement!.addEventListener('mouseleave', e => {\r\n        moreBoxElement.style.height = '3vw'\r\n      })\r\n    } else {\r\n      \r\n    }\r\n  }\r\n  const handleMessage = () => {\r\n    ws.addEventListener('message', (e) => {\r\n      const res = JSON.parse(e.data)\r\n      // console.log('---------------->message', res)\r\n      if (res.type === 'behavior') {\r\n        if (res.status) {\r\n          const optionOneIndex = optionOneArray.indexOf(res.data)\r\n          const optionTwoIndex = optionTwoArray.indexOf(res.data)\r\n          if (optionOneIndex >= 0 || optionTwoIndex >= 0) {\r\n            const reallyIndex = Math.max(optionOneIndex, optionTwoIndex)\r\n            const reallyBehavior = behaviorArray[reallyIndex]\r\n            const activeElementIndex = characterElementList.findIndex(item => item.uuid === res.uuid)\r\n            const activeElement = characterElementList[activeElementIndex].element\r\n            const characterRect = activeElement.getBoundingClientRect();\r\n            switch (reallyBehavior){\r\n              case 'forward':\r\n                activeElement.style.top = characterRect.top - 1 + 'px'\r\n                break;\r\n              case 'backward':\r\n                activeElement.style.top = characterRect.top + 1 + 'px'\r\n                break;\r\n              case 'turnLeft':\r\n                activeElement.style.left = characterRect.left - 1 + 'px'\r\n                break;\r\n              case 'turnRight':\r\n                activeElement.style.left = characterRect.left + 1 + 'px'\r\n                break;\r\n              default:\r\n                break;\r\n            }\r\n          }\r\n        } else {\r\n          console.error(res.message)\r\n        }\r\n      }\r\n      if (res.type === 'chat') {\r\n        if (res.status) {\r\n          const historyContentElement = document.querySelector('.historyContent')\r\n          historyContentList.push(`${res.uuid}:${res.data}`)\r\n          nextTick(() => {\r\n            historyContentElement!.scrollTop = 9999\r\n          })\r\n        }\r\n      }\r\n      if (res.type === 'loadCharacter') {\r\n        if (res.status) {\r\n          console.log(res.uuid)\r\n          loadCharacter(res.uuid)\r\n        }\r\n      }\r\n    })\r\n  }\r\n  const handleClickSendMessage = () => {\r\n    const obj = {\r\n      type: 'chat',\r\n      data: chatMessage.value,\r\n      uuid: counter.uuid\r\n    }\r\n    ws.send(JSON.stringify(obj))\r\n  }\r\n  const handleClickSetting = () => {\r\n    settingShow.value = true\r\n  }\r\n  const handleClickStore = () => {\r\n    storeShow.value = true\r\n  }\r\n  const handleSettingAndStoreClose = () => {\r\n    settingShow.value = false\r\n    storeShow.value = false\r\n  }\r\n  const handleLogOut = () => {\r\n    ws.close()\r\n  }\r\n  const establishConnection = () => {\r\n    ws = new WebSocket(serverAddress)\r\n    ws.addEventListener('open', async (event) => {\r\n      console.log('���ӳɹ�', event)\r\n      console.log(ws.readyState, ws.readyState === 1)\r\n      connectLoading.close()\r\n      await loadScene()\r\n      // await loadCharacter()\r\n      setControl()\r\n      handleMessage()\r\n    })\r\n    // ��������ʧ�ܺ�Ҳ�ᴥ�����listener\r\n    ws.addEventListener('error', (event) => {\r\n      const currentTime = new Date()\r\n      // 60000����Ҳ����һ���ӵĳ�ʱ\r\n      if (currentTime.getTime() - firstEnterTime.getTime() < 60000) {\r\n        establishConnection()\r\n        reconnectCount++\r\n        console.log(reconnectCount, currentTime.getTime() - firstEnterTime.getTime())\r\n      } else {\r\n        console.log('connection timed out', event)\r\n      }\r\n    })\r\n  }\r\n</script>\r\n\r\n<template>\r\n  <div class=\"container\"></div>\r\n  <div class=\"moreBox\">\r\n    <div class=\"more\"></div>\r\n    <div class=\"setting\" @click=\"handleClickSetting\"></div>\r\n    <div class=\"store\" @click=\"handleClickStore\"></div>\r\n  </div>\r\n  <div class=\"chatBox\">\r\n    <div class=\"historyContent\">\r\n      <div class=\"historyContentItem\" v-for=\"item in historyContentList\">{{ item }}</div>\r\n    </div>\r\n    <div class=\"inputBox\">\r\n      <div class=\"left\">\r\n        <input id=\"userInputBox\" @keydown.enter=\"handleClickSendMessage\" v-model=\"chatMessage\" />\r\n      </div>\r\n      <div class=\"right\">\r\n        <button @click=\"handleClickSendMessage\">����</button>\r\n      </div>\r\n    </div>\r\n  </div>\r\n  <el-dialog\r\n    v-model=\"settingShow\"\r\n    title=\"����\"\r\n    width=\"70vw\"\r\n    :before-close=\"handleSettingAndStoreClose\"\r\n  >\r\n    <span>This is a message</span>\r\n  </el-dialog>\r\n  <el-dialog\r\n    v-model=\"storeShow\"\r\n    title=\"�̳�\"\r\n    width=\"70vw\"\r\n    :before-close=\"handleSettingAndStoreClose\"\r\n  >\r\n    <span>This is a message</span>\r\n  </el-dialog>\r\n</template>\r\n\r\n<style lang=\"scss\" scoped>\r\n  $myTransitionDuration: 0.5s;\r\n  .container {\r\n    width: 100vw;\r\n    height: 100vh;\r\n  }\r\n  .moreBox {\r\n    width: 3vw;\r\n    height: 3vw;\r\n    margin: 10px;\r\n    position: absolute;\r\n    top: 0;\r\n    right: 0;\r\n    transition: all $myTransitionDuration;\r\n    overflow: hidden;\r\n    div {\r\n      width: 3vw;\r\n      height: 3vw;\r\n      border-radius: 50%;\r\n      background-size: 100% 100%;\r\n      background-repeat: no-repeat;\r\n      background-position: center;\r\n      background-color: aqua;\r\n    }\r\n    .more {\r\n      background-image: url('../../public/vite.svg');\r\n    }\r\n    .setting {\r\n      background-image: url('../../public/vite.svg');\r\n      margin: 10px 0px;\r\n    }\r\n    .store {\r\n      background-image: url('../../public/vite.svg');\r\n    }\r\n  }\r\n  .chatBox {\r\n    width: 30vw;\r\n    height: 20vh;\r\n    position: absolute;\r\n    bottom: 0;\r\n    left: 0;\r\n    border-radius: 0 20px 0 0;\r\n    border: 1px solid black;\r\n    background-color: transparent;\r\n    border-bottom: none;\r\n    overflow: hidden;\r\n    transition: all $myTransitionDuration;\r\n    .historyContent {\r\n      width: 100%;\r\n      max-height: 85%;\r\n      height: 85%;\r\n      overflow-y: auto;\r\n      display: flex;\r\n      flex-direction: column;\r\n      position: relative;\r\n      .historyContentItem {\r\n        width: 100%;\r\n      }\r\n    }\r\n    .inputBox {\r\n      position: absolute;\r\n      bottom: 0;\r\n      width: 100%;\r\n      height: 15%;\r\n      display: flex;\r\n      .left {\r\n        width: 80%;\r\n        height: 100%;\r\n        input {\r\n          height: 100%;\r\n          width: 100%;\r\n        }\r\n      }\r\n      .right {\r\n        width: 20%;\r\n        height: 100%;\r\n        overflow: hidden;\r\n        text-overflow: ellipsis;\r\n        button {\r\n          height: 100%;\r\n          width: 100%;\r\n        }\r\n      }\r\n    }\r\n  }\r\n</style>"],"names":["serverAddress","counter","useCounterStore","ws","firstEnterTime","reconnectCount","connectLoading","settingShow","ref","storeShow","keyboardCommands","characterElement","characterElementList","behaviorArray","behavior","optionOneArray","optionOne","optionTwoArray","optionTwo","chatMessage","historyContentList","reactive","onMounted","ElLoading","establishConnection","initClassNameMoreDiv","loadScene","resolve","reject","containerElement","sceneElement","e","loadCharacter","uuid","reqKeyboardCommands","response","data","err","setControl","obj","moreBoxElement","handleMessage","res","optionOneIndex","optionTwoIndex","reallyIndex","reallyBehavior","activeElementIndex","item","activeElement","characterRect","historyContentElement","nextTick","handleClickSendMessage","handleClickSetting","handleClickStore","handleSettingAndStoreClose","event","currentTime"],"mappings":"miBAMQA,GAAgB,yDADtB,MAAMC,EAAUC,IAEZ,IAAAC,EACE,MAAAC,MAAqB,KAC3B,IAAIC,EAAiB,EACjBC,EACE,MAAAC,EAAcC,EAAI,EAAK,EACvBC,EAAYD,EAAI,EAAK,EACrBE,EAAmB,CACvB,CACE,SAAU,UACV,UAAW,IACX,UAAW,SACb,EACA,CACE,SAAU,WACV,UAAW,IACX,UAAW,WACb,EACA,CACE,SAAU,WACV,UAAW,IACX,UAAW,WACb,EACA,CACE,SAAU,YACV,UAAW,IACX,UAAW,YACb,CAAA,EAEE,IAAAC,EACJ,MAAMC,EAGD,CAAA,EACCC,EAAgBH,EAAiB,IAAI,CAAC,CAAE,SAAAI,CAAA,IAAeA,CAAQ,EAC/DC,EAAiBL,EAAiB,IAAI,CAAC,CAAE,UAAAM,CAAA,IAAgBA,CAAS,EAClEC,EAAiBP,EAAiB,IAAI,CAAC,CAAE,UAAAQ,CAAA,IAAgBA,CAAS,EAClEC,EAAcX,EAAI,EAAE,EAEpBY,EAAqBC,EAAoB,CAAA,CAAE,EAEjDC,EAAU,IAAM,CACdhB,EAAiBiB,EAAU,QAAQ,CACjC,KAAM,GACN,KAAM,UACN,WAAY,oBAAA,CACb,EACmBC,IACCC,GAAA,CACtB,EACD,MAAMC,EAAY,IACT,IAAI,QAAQ,CAACC,EAASC,IAAW,CAClC,GAAA,CACI,MAAAC,EAAmB,SAAS,cAAc,YAAY,EACtDC,EAAe,SAAS,cAAc,KAAK,EACpCA,EAAA,aAAa,QAAS,OAAO,EAC1CA,EAAa,MAAM,MAAQ,QAC3BA,EAAa,MAAM,OAAS,QAC5BA,EAAa,MAAM,gBAAkB,IACrCD,EAAkB,YAAYC,CAAY,EAC1CH,EAAQ,EAAI,QACLI,EAAG,CACF,QAAA,MAAM,cAAeA,CAAC,EAC9BH,EAAO,EAAK,CACd,CAAA,CACD,EAEGI,EAAiBC,GACd,IAAI,QAAQ,CAACN,EAASC,IAAW,CAClC,GAAA,CACI,MAAAE,EAAe,SAAS,cAAc,QAAQ,EACjCnB,EAAA,SAAS,cAAc,KAAK,EAC9BA,EAAA,aAAa,KAAMsB,CAAI,EACxCtB,EAAiB,MAAM,MAAQ,MAC/BA,EAAiB,MAAM,OAAS,MAChCA,EAAiB,MAAM,gBAAkB,eACzCA,EAAiB,MAAM,SAAW,QAClCA,EAAiB,UAAYsB,EAC7BH,EAAc,YAAYnB,CAAgB,EAC1CC,EAAqB,KAAK,CACxB,KAAAqB,EACA,QAAStB,CAAA,CACV,EACDgB,EAAQ,EAAI,QACLI,EAAG,CACF,QAAA,MAAM,aAAcA,CAAC,EAC7BH,EAAO,EAAK,CACd,CAAA,CACD,EAEGM,EAAsB,IAAM,CAChC,MAAM,6BAA8B,CAClC,OAAQ,OACR,KAAM,KAAK,UAAU,CACnB,KAAM,KAAA,CACP,EACD,QAAS,CACP,eAAgB,kBAClB,CAAA,CACD,EACA,KAAKC,GAAYA,EAAS,MAAM,EAChC,KAAaC,GAAA,CACZ,QAAQ,IAAI,YAAY,KAAK,UAAUA,CAAI,CAAC,EAAE,CAAA,CAC/C,EACA,MAAaC,GAAA,CACZ,QAAQ,IAAI,OAAO,KAAK,UAAUA,CAAG,CAAC,EAAE,CAAA,CACzC,CAAA,EAEGC,EAAa,IAAM,CAEnBrC,EAAQ,aAAe,OACLiC,IACb,OAAA,iBAAiB,UAAY,GAAM,CAExC,GAD6C,EAAE,OACxB,aAAa,IAAI,IAAM,eAC5C,OAEF,MAAMK,EAAM,CACV,KAAM,WACN,KAAM,EAAE,IAAI,YAAY,EACxB,KAAMtC,EAAQ,IAAA,EAEhBE,EAAG,KAAK,KAAK,UAAUoC,CAAG,CAAC,CAAA,CAC5B,EAGH,EAEId,EAAuB,IAAM,CAC3B,MAAAe,EAAiC,SAAS,cAAc,UAAU,EAEpEvC,EAAQ,aAAe,OACTuC,EAAA,iBAAiB,aAAmBT,GAAA,CAClDS,EAAe,MAAM,OAAS,kBAAA,CAC/B,EACeA,EAAA,iBAAiB,aAAmBT,GAAA,CAClDS,EAAe,MAAM,OAAS,KAAA,CAC/B,EAGH,EAEIC,EAAgB,IAAM,CACvBtC,EAAA,iBAAiB,UAAY,GAAM,CACpC,MAAMuC,EAAM,KAAK,MAAM,EAAE,IAAI,EAEzB,GAAAA,EAAI,OAAS,WACf,GAAIA,EAAI,OAAQ,CACd,MAAMC,EAAiB5B,EAAe,QAAQ2B,EAAI,IAAI,EAChDE,EAAiB3B,EAAe,QAAQyB,EAAI,IAAI,EAClD,GAAAC,GAAkB,GAAKC,GAAkB,EAAG,CAC9C,MAAMC,EAAc,KAAK,IAAIF,EAAgBC,CAAc,EACrDE,EAAiBjC,EAAcgC,CAAW,EAC1CE,EAAqBnC,EAAqB,aAAkBoC,EAAK,OAASN,EAAI,IAAI,EAClFO,EAAgBrC,EAAqBmC,CAAkB,EAAE,QACzDG,EAAgBD,EAAc,wBACpC,OAAQH,EAAe,CACrB,IAAK,UACHG,EAAc,MAAM,IAAMC,EAAc,IAAM,EAAI,KAClD,MACF,IAAK,WACHD,EAAc,MAAM,IAAMC,EAAc,IAAM,EAAI,KAClD,MACF,IAAK,WACHD,EAAc,MAAM,KAAOC,EAAc,KAAO,EAAI,KACpD,MACF,IAAK,YACHD,EAAc,MAAM,KAAOC,EAAc,KAAO,EAAI,KACpD,KAGJ,CACF,CAAA,MAEQ,QAAA,MAAMR,EAAI,OAAO,EAGzB,GAAAA,EAAI,OAAS,QACXA,EAAI,OAAQ,CACR,MAAAS,EAAwB,SAAS,cAAc,iBAAiB,EACtE/B,EAAmB,KAAK,GAAGsB,EAAI,IAAI,IAAIA,EAAI,IAAI,EAAE,EACjDU,GAAS,IAAM,CACbD,EAAuB,UAAY,IAAA,CACpC,CACH,CAEET,EAAI,OAAS,iBACXA,EAAI,SACE,QAAA,IAAIA,EAAI,IAAI,EACpBV,EAAcU,EAAI,IAAI,EAE1B,CACD,CAAA,EAEGW,EAAyB,IAAM,CACnC,MAAMd,EAAM,CACV,KAAM,OACN,KAAMpB,EAAY,MAClB,KAAMlB,EAAQ,IAAA,EAEhBE,EAAG,KAAK,KAAK,UAAUoC,CAAG,CAAC,CAAA,EAEvBe,EAAqB,IAAM,CAC/B/C,EAAY,MAAQ,EAAA,EAEhBgD,EAAmB,IAAM,CAC7B9C,EAAU,MAAQ,EAAA,EAEd+C,EAA6B,IAAM,CACvCjD,EAAY,MAAQ,GACpBE,EAAU,MAAQ,EAAA,EAKde,EAAsB,IAAM,CAC3BrB,EAAA,IAAI,UAAUH,EAAa,EAC7BG,EAAA,iBAAiB,OAAQ,MAAOsD,GAAU,CACnC,QAAA,IAAI,SAAUA,CAAK,EAC3B,QAAQ,IAAItD,EAAG,WAAYA,EAAG,aAAe,CAAC,EAC9CG,EAAe,MAAM,EACrB,MAAMoB,EAAU,EAELY,IACGG,GAAA,CACf,EAEEtC,EAAA,iBAAiB,QAAUsD,GAAU,CAChC,MAAAC,MAAkB,KAEpBA,EAAY,QAAQ,EAAItD,EAAe,QAAA,EAAY,KACjCoB,IACpBnB,IACA,QAAQ,IAAIA,EAAgBqD,EAAY,UAAYtD,EAAe,SAAS,GAEpE,QAAA,IAAI,uBAAwBqD,CAAK,CAC3C,CACD,CAAA"}